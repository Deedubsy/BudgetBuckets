<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Plan — Budget Buckets</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="/assets/css/base.css">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    
    <!-- Favicon and PWA Assets -->
    <link rel="icon" href="/assets/img/budget-buckets-dollar.ico" sizes="any">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon-dollar.png">
    <link rel="manifest" href="/budgetbuckets.webmanifest">
    <meta name="theme-color" content="#0b0f14">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://www.gstatic.com https://apis.google.com https://www.googleapis.com https://js.stripe.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://www.gstatic.com; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.googleapis.com https://api.stripe.com; frame-src 'self' https://js.stripe.com https://hooks.stripe.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self'">
</head>
<body>
    <main class="auth-container">
        <div class="auth-card plan-selection">
            <header class="auth-header">
                <h1><a href="/" style="color: inherit; text-decoration: none;">Budget Buckets</a></h1>
                <p class="tagline">Your personal budgeting companion</p>
            </header>

            <div class="plan-selection-content">
                <h2>Choose your plan</h2>
                <p>Select the plan that's right for you. You can upgrade or downgrade at any time.</p>

                <div class="plans-container">
                    <!-- Free Plan -->
                    <div class="plan-card" id="freePlan">
                        <div class="plan-header">
                            <h3>Free</h3>
                            <div class="plan-price">$0<span>/month</span></div>
                        </div>
                        <div class="plan-features">
                            <ul>
                                <li>✅ Up to 5 budget buckets</li>
                                <li>✅ Income tracking</li>
                                <li>✅ Expense management</li>
                                <li>✅ Cloud sync</li>
                                <li>✅ Multi-currency support</li>
                            </ul>
                        </div>
                        <button type="button" id="plan-free-btn" data-testid="plan-free-btn" class="btn btn-secondary plan-btn">
                            Start with Free
                        </button>
                    </div>

                    <!-- Plus Plan -->
                    <div class="plan-card plus-plan" id="plusPlan">
                        <div class="plan-badge">Most Popular</div>
                        <div class="plan-header">
                            <h3>Plus</h3>
                            <div class="plan-price">$3.99<span>/month</span></div>
                        </div>
                        <div class="plan-features">
                            <ul>
                                <li>✅ <strong>Unlimited budget buckets</strong></li>
                                <li>✅ Advanced analytics</li>
                                <li>✅ Export capabilities</li>
                                <li>✅ Priority support</li>
                                <li>✅ All Free features</li>
                            </ul>
                        </div>
                        <button type="button" id="plan-plus-btn" data-testid="plan-plus-btn" class="btn btn-primary plan-btn">
                            Start Plus Plan
                        </button>
                    </div>
                </div>

                <div class="plan-selection-footer">
                    <p><small>
                        No setup fees. Cancel anytime. 
                        <a href="/terms" target="_blank">Terms</a> and 
                        <a href="/privacy" target="_blank">Privacy Policy</a>.
                    </small></p>
                </div>
            </div>

            <!-- Stripe Payment Element (hidden initially) -->
            <div id="paymentSection" class="payment-section" style="display: none;">
                <h3>Complete your Plus subscription</h3>
                <div id="payment-element">
                    <!-- Stripe Elements will create form elements here -->
                </div>
                <button id="payment-submit" class="btn btn-primary">
                    <span id="button-text">Subscribe to Plus</span>
                    <div id="payment-spinner" class="payment-spinner" style="display: none;"></div>
                </button>
                <button id="payment-cancel" class="btn btn-link">
                    Back to plans
                </button>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>
        </div>
    </main>

    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script type="module" src="./firebase.js"></script>
    <script type="module" src="/app/lib/billing-client.js"></script>
    <script type="module" src="./js/choose-plan.js"></script>
</body>
</html>